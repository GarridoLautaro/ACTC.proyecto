<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campeonato ACTC</title>
    <link rel="stylesheet" href="../style.css">
</head>

<body>

<!-- Navbar -->
<nav class="navbar">
    <div class="logo"><img src="Recursos/LOGO.png" alt="Logo ACTC"></div>
    <ul class="nav-links">
        <li><a href="inicio.html">INICIO</a></li>
        <li><a href="campeonato.html" class="active">CAMPEONATO</a></li>
        <li><a href="calendario.html">CALENDARIO</a></li>
        <li><a href="campeonato.html">REGISTRO</a></li>
    </ul>
</nav>

<!-- Contenido -->
<main class="tabla-wrap">
    <div class="tabla-head">
        <div>POS.</div>
        <div>NÚMERO</div>
        <div>PILOTO</div>
        <div>MARCA</div>
        <div>PTOS.</div>
    </div>
    <div id="tabla-body"></div>
</main>

<!-- Footer -->
<footer class="site-footer">
    <div class="footer-inner"><strong>FOOTER</strong></div>
</footer>

<script>
async function cargarTabla(){
    const cont = document.getElementById('tabla-body');
    cont.innerHTML = '<div class="tabla-empty">Cargando…</div>';
    try{
        const res = await fetch('/ACTC.proyecto/Pagina/api/listar_campeonato.php', {
        headers:{'Accept':'application/json'}
    });
    if(!res.ok) throw new Error('HTTP ' + res.status);
    const json = await res.json();

    if(!json.ok){
        cont.innerHTML = `<div class="tabla-empty">Error del servidor</div>`;
        return;
    }
    const data = Array.isArray(json.data) ? json.data : [];
    if(data.length === 0){
        cont.innerHTML = '<div class="tabla-empty">No hay pilotos cargados todavía.</div>';
        return;
    }

    data.sort((a,b)=> (b.puntos - a.puntos) || a.nombre.localeCompare(b.nombre));
    cont.innerHTML = '';
    data.forEach((r, i) => {
        const fila = document.createElement('div');
        fila.className = 'fila';
        fila.innerHTML = `
            <div class="pos">${i+1}°</div>
            <div class="num">${r.numero ?? ''}</div>
            <div class="piloto">${(r.nombre || '').toUpperCase()}</div>
            <div class="marca">
                ${r.logo ? `<img src="${r.logo}" alt="${r.marca || ''}">` : ''}
                <span>${r.marca ?? ''}</span>
            </div>
            <div class="pts"><span class="badge-pts">${Number(r.puntos ?? 0).toFixed(1).replace('.0','')}</span></div>
        `;
    cont.appendChild(fila);
    });
}catch(e){
    cont.innerHTML = `<div class="tabla-empty">No se pudo cargar la tabla (${e.message}).</div>`;
    console.error(e);
}
}
document.addEventListener('DOMContentLoaded', cargarTabla);
</script>
</body>
</html>
